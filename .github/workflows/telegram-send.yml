name: Notify Telegram on Push

on:
  push: # Trigger on ALL branches
    branches:
      - "**"

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram Message
        run: |
          BRANCH=${{ github.ref_name }}
          REPO=${{ github.repository }}
          PUSHER=${{ github.actor }}

          # Collect all commit messages from this push
          COMMITS=$(jq -r '.commits[] | "- \(.message) (<a href=\"\(.url)\">Check Code</a>)"' <<< '${{ toJson(github.event) }}')

          # Build Telegram message using HTML (much more reliable than Markdown)
          MSG="ðŸ“¢ <b>GitHub Push Event</b>
          ðŸ“‚ Repo: $REPO
          ðŸŒ¿ Branch: $BRANCH
          ðŸ‘¤ Pusher: $PUSHER

          ðŸ”¨ Commits:
          $COMMITS"

          # Send to Telegram using HTML parse mode
          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage \
          -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
          -d parse_mode="HTML" \
          -d text="$MSG"
